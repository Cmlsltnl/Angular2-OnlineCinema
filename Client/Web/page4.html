<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Online Cinema</title>
    <!-- Bootstrap -->
    <link href="assets/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="assets/css/styles.css">
    <link rel="stylesheet" href="assets/css/font-awesome.min.css">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link href='https://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
</head>

<body>
    <header id="header" class="">
        <div class="top-header clearfix">
            <div class="wrapper">
                <div class="left-top-header btn-title">
                    Monday, November 28, 2016
                </div>
                <div class="right-top-header">
                    <ul class="nav navbar-nav navbar-right">
                        <li><a href="#"><span class="glyphicon glyphicon-user"></span> Sign Up</a></li>
                        <li><a href="#"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="wrapper main-header">
            <div class="banner">
                <div class="site-branding clearfix">
                    <div class="site-logo float-left">
                        <a href="http://lichchieuphimcgv.com/" class="custom-logo-link" rel="home" itemprop="url"><img width="290" height="59" src="http://lichchieuphimcgv.com/wp-content/uploads/2016/07/cropped-logo-lichchieuphimcgv.png" class="custom-logo" alt="cropped-logo-lichchieuphimcgv.png" itemprop="logo"></a>
                    </div>
                    <!--site-logo-->
                    <!--supermag-header-id-display-opt-->
                    <div class="clearfix"></div>
                </div>
            </div>
            <div class="main-menu">
                <nav id="site-navigation" class="main-navigation clearfix" role="navigation">
                    <div class="header-main-menu clearfix">
                        <div class="home-icon front_page_on">
                            <a href="index.html" title="Lịch chiếu phim CGV"><i class="fa fa-home"></i></a>
                        </div>
                        <div class="acmethemes-nav">
                            <ul id="menu-menu-1" class="menu">
                                <li id="menu-item-1" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-26"><a href="">Phim</a></li>
                                <li id="menu-item-2" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-27"><a href="">Rạp</a></li>
                                <li id="menu-item-3" class="menu-item menu-item-type-post_type menu-item-object-post menu-item-25"><a href="">Lịch chiếu</a></li>
                                <li id="menu-item-4" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-59"><a href="page4.html">Hướng dẫn</a></li>
                            </ul>
                        </div>
                        <div class="search-block">
                            <form action="http://lichchieuphimcgv.com" class="searchform" id="searchform" method="get" role="search">
                                <div>
                                    <label for="menu-search" class="screen-reader-text"></label>
                                    <input type="text" placeholder="Search" id="menu-search" name="s" value="">
                                    <button class="fa fa-search" type="submit" id="searchsubmit"></button>
                                </div>
                            </form>
                        </div>
                    </div>
                </nav>
            </div>
        </div>
    </header>
    <div class="container wrapper content-wrapper clearfix" style="height: 100%;">
        <div id="map" style="height: 500px"></div>
        <div id="warnings-panel"></div>
    </div>
    <footer>
    </footer>
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <script type="text/javascript">
    var markers = [{
        "title": 'CGV-Aeon Mall Bình Tân',
        "lat": '10.743646',
        "lng": '106.6075981',
        "description": '1 Đường số 17A, Bình Trị Đông B, phường Bình Trị Đông B, Ho Chi Minh City 700000, Vietnam'
    }, {
        "title": 'CGV Pandora City',
        "lat": '10.8069193',
        "lng": '106.6320505',
        "description": 'Lầu 3, Pandora City, 1 Trường Chinh, Tây Thạnh, Tân Phú, Hồ Chí Minh, Vietnam'
    }];
    // window.onload = function() {
    //     LoadMap();
    // }

    function LoadMap() {
        var mapOptions = {
            center: new google.maps.LatLng(markers[0].lat, markers[0].lng),
            zoom: 10,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var map = new google.maps.Map(document.getElementById("map"), mapOptions);

        //Create and open InfoWindow.
        var infoWindow = new google.maps.InfoWindow({
            map: map
        });

        //icon cinema 
        var markerImage = 'assets/images/galaxy.png';
        var usermarkerImage = 'assets/images/currentMarker.png';

        // Try HTML5 geolocation.
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                var pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };

                var currentmarker = {
                    "title": 'Me',
                    "lat": position.coords.latitude,
                    "lng": position.coords.longitude,
                    "description": '101 Vĩnh Viễn, phường 7, Quận 11, Hồ Chí Minh, Việt Nam'
                };
                markers.push(currentmarker);

                // var usermarker = new google.maps.Marker({
                //     position: pos,
                //     map: map,
                //     title: 'Me',
                //     icon: usermarkerImage
                // });

                //infoWindow.setPosition(pos);
                //infoWindow.setContent('Location found.');
                //map.setCenter(pos);
                //infoWindow.open(map, marker);

                var markerArray = [];

                // Instantiate a directions service.
                var directionsService = new google.maps.DirectionsService;

                // Create a renderer for directions and bind it to the map.
                var directionsDisplay = new google.maps.DirectionsRenderer({
                    map: map
                });

                for (var i = 0; i < markers.length; i++) {
                    var data = markers[i];
                    var myLatlng = new google.maps.LatLng(data.lat, data.lng);
                    var marker = new google.maps.Marker({
                        position: myLatlng,
                        map: map,
                        title: data.title,
                        icon: markerImage
                    });
                    if (data.lat == pos.lat && data.lng == pos.lng) {
                        marker.icon = usermarkerImage;
                    }
                    //Attach click event to the marker.
                    (function(marker, data) {
                        google.maps.event.addListener(marker, "click", function(e) {
                            //Wrap the content inside an HTML DIV in order to set height and width of InfoWindow.
                            infoWindow.setContent("<div style = 'width:200px;min-height:40px'>" + data.description + "</div>");
                            infoWindow.open(map, marker);

                        // Listen to change events from the start and end lists.
                        var onChangeHandler = function() {
                            var orginLocation = currentmarker.description;;
                            var destinationLocation = marker.description;
                            calculateAndDisplayRoute(
                                orginLocation, destinationLocation, directionsDisplay, directionsService, markerArray, infoWindow, map);
                        };
                        });
                    })(marker, data);
                };

            }, function() {
                handleLocationError(true, infoWindow, map.getCenter());
            });
        } else {
            // Browser doesn't support Geolocation
            handleLocationError(false, infoWindow, map.getCenter());
        }

        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
            infoWindow.setPosition(pos);
            infoWindow.setContent(browserHasGeolocation ?
                'Error: The Geolocation service failed.' :
                'Error: Your browser doesn\'t support geolocation.');
        }

        function calculateAndDisplayRoute(orginLocation, destinationLocation,directionsDisplay, directionsService,
            markerArray, infoWindow, map) {
            // First, remove any existing markers from the map.
            for (var i = 0; i < markerArray.length; i++) {
                markerArray[i].setMap(null);
            }

            // Retrieve the start and end locations and create a DirectionsRequest using
            // WALKING directions.
            directionsService.route({
                origin: orginLocation,
                destination: destinationLocation,
                travelMode: 'WALKING'
            }, function(response, status) {
                // Route the directions and pass the response to a function to create
                // markers for each step.
                if (status === 'OK') {
                    document.getElementById('warnings-panel').innerHTML =
                        '<b>' + response.routes[0].warnings + '</b>';
                    directionsDisplay.setDirections(response);
                    showSteps(response, markerArray, infoWindow, map);
                } else {
                    window.alert('Directions request failed due to ' + status);
                }
            });
        }

        function showSteps(directionResult, markerArray, infoWindow, map) {
            // For each step, place a marker, and add the text to the marker's infowindow.
            // Also attach the marker to an array so we can keep track of it and remove it
            // when calculating new routes.
            var myRoute = directionResult.routes[0].legs[0];
            for (var i = 0; i < myRoute.steps.length; i++) {
                var marker = markerArray[i] = markerArray[i] || new google.maps.Marker;
                marker.setMap(map);
                marker.setPosition(myRoute.steps[i].start_location);
                attachInstructionText(
                    infoWindow, marker, myRoute.steps[i].instructions, map);
            }
        }

        function attachInstructionText(infoWindow, marker, text, map) {
            google.maps.event.addListener(marker, 'click', function() {
                // Open an info window when the marker is clicked on, containing the text
                // of the step.
                infoWindow.setContent(text);
                infoWindow.open(map, marker);
            });
        }
    }
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCDEzb2O2TWLG-SAcv5XU1YkvzHWDy0eTQ&callback=LoadMap" type="text/javascript"></script>
</body>

</html>
